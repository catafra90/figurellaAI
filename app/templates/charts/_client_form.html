{# app/templates/charts/_client_form.html #}

<div class="space-y-6">

  <!-- Styles for tabs, zebra‑striping, sticky headers, scrollable areas -->
  <style>
    /* Tabs container */
    .tabs-list {
      display: flex;
      gap: 1rem;
      list-style: none;
      margin: 0;
      padding: 0;
      overflow-x: auto;
      white-space: nowrap;
    }
    .tabs-list::-webkit-scrollbar { display: none; }
    .tabs-list { -ms-overflow-style: none; scrollbar-width: none; }
    .tabs-list .tab-btn {
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: color .2s, border-color .2s;
    }
    .tabs-list .tab-btn.active {
      color: #CC0066;
      border-color: #CC0066;
    }
    .tabs-list .tab-btn:hover {
      color: #AA0055;
      border-color: #AA0055;
    }
    .tabs-list .tab-btn:focus {
      outline: 2px solid #CC0066;
      outline-offset: 2px;
    }
    .tabs-wrapper { position: relative; }
    #tabUnderline {
      position: absolute;
      bottom: 0;
      height: 2px;
      background: #CC0066;
      transition: left .3s, width .3s;
    }

    /* Zebra striping & sticky headers */
    .zebra-pink tbody tr:nth-child(even) {
      background-color: rgba(204, 0, 102, 0.1);
    }
    .sticky-header thead th {
      position: sticky;
      top: 0;
      background: #f9fafb;
      z-index: 10;
    }

    /* Scrollable area for tables */
    .scrollable-table {
      max-height: 300px; /* adjust as needed */
      overflow-y: auto;
    }
  </style>

  <!-- Tabs Navigation -->
  <div class="border-b mb-4 tabs-wrapper">
    <ul class="tabs-list">
      <li><button class="tab-btn px-4 py-2 border-b-2 border-figurella active" data-tab="profile">Profile</button></li>
      <li><button class="tab-btn px-4 py-2 border-b-2 border-transparent"       data-tab="measures">Measures</button></li>
      <li><button class="tab-btn px-4 py-2 border-b-2 border-transparent"       data-tab="workout">Workout</button></li>
      <li><button class="tab-btn px-4 py-2 border-b-2 border-transparent"       data-tab="nutrition">Nutrition</button></li>
      <li><button class="tab-btn px-4 py-2 border-b-2 border-transparent"       data-tab="communication">Communication</button></li>
    </ul>
    <span id="tabUnderline"></span>
  </div>

  <!-- Tab: Profile -->
  <div id="profile" class="tab-content space-y-6 p-4">
    {% include 'charts/_header_table.html' %}
  </div>

  <!-- Tab: Measures -->
  <div id="measures" class="tab-content hidden space-y-6 p-4">
    <h2 class="text-lg font-semibold mb-4">Measures</h2>

    <!-- Measures Table -->
    <div class="overflow-x-auto border rounded-lg mb-6 scrollable-table">
      {% include 'charts/_measures_table.html' %}
    </div>
  </div>

<!-- ===== Tab: Workout ===== -->
<div id="workout" class="tab-content hidden space-y-6 p-4">
  {% set wcols = sheets['workout'].columns %}
  {% set wrec  = workout_data[0] if workout_data else {} %}

  <h2 class="text-lg font-semibold mb-4">Program</h2>

<div class="flex items-center space-x-2 mb-4">
  <label for="workout-kg" class="font-medium">KG :</label>
  <input
    id="workout-kg"
    name="workout_kg"
    type="text"
    value="{{ wrec[wcols[0]] }}"
    class="w-24 border border-gray-300 rounded px-2 py-1"
  />
</div>


<!-- Tools Field -->
<div class="flex items-center space-x-2 mb-6">
  <label for="workout-tools" class="font-medium">Tools :</label>
  <input
    id="workout-tools"
    name="workout_tools"
    type="text"
    value="{{ wrec[wcols[1]] }}"
    class="w-64 border border-gray-300 rounded px-2 py-1"
  />
</div>

  <!-- Rings Table -->
  <div class="overflow-x-auto mb-6">
    <table class="w-full border-collapse text-sm zebra-pink sticky-header">
      <thead class="bg-gray-100 font-semibold text-gray-700">
        <tr>
          <th class="border px-2 py-1">#</th>
          <th class="border px-2 py-1">Workout</th>
          <th class="border px-2 py-1">Rings</th>
          <th class="border px-2 py-1">Notes</th>
        </tr>
      </thead>
      <tbody>
        {# 17 rows now #}
        {% for i in range(1,18) %}
        <tr>
          <td class="border px-2 py-1 text-center font-semibold">{{ i }}</td>
          <td class="border px-2 py-1">
            {{ workout_data[i-1][wcols[2]] if workout_data|length >= i else '' }}
          </td>
          <td class="border px-2 py-1">
            {{ workout_data[i-1][wcols[3]] if workout_data|length >= i else '' }}
          </td>
          <td class="border px-2 py-1">
            {{ workout_data[i-1][wcols[4]] if workout_data|length >= i else '' }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Goldorack Table -->
  <h3 class="text-lg font-semibold mb-2">Goldorack</h3>
  <div class="overflow-x-auto border rounded-lg mb-6">
    <table
      id="goldorack-table"
      class="table-auto w-full border-collapse text-sm zebra-pink sticky-header"
    >
      <colgroup>
        <col class="w-auto">
        <col class="w-full">
      </colgroup>
      <thead class="bg-gray-100 font-semibold text-gray-700">
        <tr>
          <th colspan="2" class="border px-2 py-1">&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        {% for j in range(1,5) %}
        <tr>
          <td class="border px-2 py-1 whitespace-nowrap">GK</td>
          <td class="border px-2 py-1">
            {{ workout_data[j-1][wcols[5]] if workout_data|length >= j else '' }}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<!-- Stretching Field -->
<div class="flex items-center space-x-2">
  <label for="stretching" class="font-medium">Stretching :</label>
  <input
    id="stretching"
    name="stretching"
    type="text"
    value="{{ wrec[wcols[6]] }}"
    class="w-72 h-12 border border-gray-300 rounded px-2 py-1"
  />
</div>
</div>


<!-- Tab: Nutrition -->
<div id="nutrition" class="tab-content hidden space-y-6 p-4">
  <h2 class="text-xl font-bold">Nutrition</h2>

  {# grab the Excel headers so we can index into the data #}
  {% set nut_cols = sheets['nutrition'].columns %}

  <template id="nutrition-row-template">
    <div class="flex space-x-4 form-row mt-4">
      <!-- Date -->
      <div class="flex flex-col w-32">
        <label class="text-sm font-medium mb-1">Date</label>
        <input
          name="nutrition_date[]"
          type="date"
          class="border rounded px-2 py-1 w-full"
        />
      </div>
      <!-- Type -->
      <div class="flex flex-col w-32">
        <label class="text-sm font-medium mb-1">Type</label>
        <input
          name="nutrition_type[]"
          type="text"
          placeholder="Type"
          class="border rounded px-2 py-1 w-full"
        />
      </div>
      <!-- Notes -->
      <div class="flex flex-col flex-1">
        <label class="text-sm font-medium mb-1">Notes</label>
        <textarea
          name="nutrition_notes[]"
          rows="3"
          placeholder="Notes"
          class="border rounded px-2 py-1 w-full"
        ></textarea>
      </div>
    </div>
  </template>

  <div id="nutrition-rows">
    {# Render each saved row from Excel #}
    {% for row in nutrition_data %}
      <div class="flex space-x-4 form-row mt-4">
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Date</label>
          <input
            name="nutrition_date[]"
            type="date"
            value="{{ row[nut_cols[0]] }}"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Type</label>
          <input
            name="nutrition_type[]"
            type="text"
            value="{{ row[nut_cols[1]] }}"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <div class="flex flex-col flex-1">
          <label class="text-sm font-medium mb-1">Notes</label>
          <textarea
            name="nutrition_notes[]"
            rows="3"
            class="border rounded px-2 py-1 w-full"
          >{{ row[nut_cols[2]] }}</textarea>
        </div>
      </div>
    {% endfor %}

    {# If no data, show a single blank row by default #}
    {% if nutrition_data|length == 0 %}
      <div class="flex space-x-4 form-row mt-4">
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Date</label>
          <input
            name="nutrition_date[]"
            type="date"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Type</label>
          <input
            name="nutrition_type[]"
            type="text"
            placeholder="Type"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <div class="flex flex-col flex-1">
          <label class="text-sm font-medium mb-1">Notes</label>
          <textarea
            name="nutrition_notes[]"
            rows="3"
            placeholder="Notes"
            class="border rounded px-2 py-1 w-full"
          ></textarea>
        </div>
      </div>
    {% endif %}
  </div>

  <button
    type="button"
    class="mt-4 px-4 py-2 bg-figurella text-white rounded"
    onclick="
      const rows = document.getElementById('nutrition-rows');
      const tpl  = document
                     .getElementById('nutrition-row-template')
                     .content.cloneNode(true);
      rows.appendChild(tpl);
    "
  >
    + Add Row
  </button>
</div>

<!-- Tab: Communication -->
<div id="communication" class="tab-content hidden space-y-6 p-4">
  <h2 class="text-xl font-bold">Communication Log</h2>

  {# grab the sheet’s column names so we can index into saved data #}
  {% set comm_cols = sheets['communication'].columns %}

  <!-- Template for adding a new blank row -->
  <template id="comm-row-template">
    <div class="flex space-x-4 form-row mt-4">
      <!-- Date -->
      <div class="flex flex-col w-32">
        <label class="text-sm font-medium mb-1">Date</label>
        <input
          name="comm_date[]"
          type="date"
          class="border rounded px-2 py-1 w-full"
        />
      </div>
      <!-- Type -->
      <div class="flex flex-col w-32">
        <label class="text-sm font-medium mb-1">Type</label>
        <input
          name="comm_type[]"
          type="text"
          placeholder="Type"
          class="border rounded px-2 py-1 w-full"
        />
      </div>
      <!-- Notes -->
      <div class="flex flex-col flex-1">
        <label class="text-sm font-medium mb-1">Notes</label>
        <textarea
          name="comm_notes[]"
          rows="3"
          placeholder="Notes"
          class="border rounded px-2 py-1 w-full"
        ></textarea>
      </div>
    </div>
  </template>

  <!-- Container for all rows -->
  <div id="comm-rows">
    {# 1) Render saved rows from Excel #}
    {% for row in communication_data %}
      <div class="flex space-x-4 form-row mt-4">
        <!-- Date -->
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Date</label>
          <input
            name="comm_date[]"
            type="date"
            class="border rounded px-2 py-1 w-full"
            value=""
          />
        </div>
        <!-- Type -->
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Type</label>
          <input
            name="comm_type[]"
            type="text"
            class="border rounded px-2 py-1 w-full"
            value="{{ row[comm_cols[1]] }}"
          />
        </div>
        <!-- Notes -->
        <div class="flex flex-col flex-1">
          <label class="text-sm font-medium mb-1">Notes</label>
          <textarea
            name="comm_notes[]"
            rows="3"
            class="border rounded px-2 py-1 w-full"
          >{{ row[comm_cols[2]] }}</textarea>
        </div>
      </div>
    {% endfor %}

    {# 2) If there were no saved rows, show one blank row #}
    {% if communication_data|length == 0 %}
      <div class="flex space-x-4 form-row mt-4">
        <!-- Date -->
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Date</label>
          <input
            name="comm_date[]"
            type="date"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <!-- Type -->
        <div class="flex flex-col w-32">
          <label class="text-sm font-medium mb-1">Type</label>
          <input
            name="comm_type[]"
            type="text"
            placeholder="Type"
            class="border rounded px-2 py-1 w-full"
          />
        </div>
        <!-- Notes -->
        <div class="flex flex-col flex-1">
          <label class="text-sm font-medium mb-1">Notes</label>
          <textarea
            name="comm_notes[]"
            rows="3"
            placeholder="Notes"
            class="border rounded px-2 py-1 w-full"
          ></textarea>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- “+ Add Row” -->
  <button
    type="button"
    class="mt-4 px-4 py-2 bg-figurella text-white rounded"
    onclick="
      const rows = document.getElementById('comm-rows');
      const tpl  = document.getElementById('comm-row-template').content.cloneNode(true);
      rows.appendChild(tpl);
    "
  >
    + Add Row
  </button>
</div>

